<!DOCTYPE html>
<html>
<body style="align-items: center; text-align: center">
    
    <h2>Complaint Management System</h2>

    <h3>Submit Complaint</h3>
    <form id="complaintForm">
        <input type="text" id="userName" placeholder="User Name" required><br><br>
        <input type="text" id="issue" placeholder="Issue" required><br><br>
        <button type="submit">Submit Complaint</button>
    </form>

    <br>

    <h3>Update Complaint Status</h3>
    <form id="updateForm">
        <input type="text" id="complaintId" placeholder="Complaint ID" required><br><br>
        <select id="status" required>
            <option value="">Select Status</option>
            <option value="In Progress">In Progress</option>
            <option value="Resolved">Resolved</option>
        </select><br><br>
        <button type="submit">Update Status</button>
    </form>

    <br>

    <button id="show-pending">Show Pending Complaints</button>
    <button id="show-all">Show All Complaints</button>

    <script>
        // SUBMIT COMPLAINT
        document.getElementById("complaintForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const data = {
                userName: document.getElementById("userName").value,
                issue: document.getElementById("issue").value
            };

            const res = await fetch("/complaints", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                const result = await res.json();
                alert(`Complaint submitted! ID: ${result.complaintId}`);
                document.getElementById("complaintForm").reset();
            } else {
                alert("Error!");
            }
        });

        // UPDATE COMPLAINT STATUS
        document.getElementById("updateForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const data = {
                complaintId: document.getElementById("complaintId").value,
                status: document.getElementById("status").value
            };

            const res = await fetch("/complaints/status", {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                alert(`Complaint ${data.complaintId} status updated!`);
                document.getElementById("updateForm").reset();
            } else {
                alert("ERROR!");
            }
        });

        // SHOW PENDING COMPLAINTS
        document.getElementById("show-pending").addEventListener("click", async (e) => {
            e.preventDefault();

            const res = await fetch("/complaints/pending", {
                method: "GET",
            });

            if (res.ok) {
                const complaints = await res.json();
                console.log("Pending Complaints:", complaints);
                console.log(JSON.stringify(complaints, null, 2));
                alert(`Found ${complaints.length} pending complaints. Check console for details.`);
            } else {
                alert("Error");
            }
        });

        // SHOW ALL COMPLAINTS
        document.getElementById("show-all").addEventListener("click", async (e) => {
            e.preventDefault();

            const res = await fetch("/complaints", {
                method: "GET",
            });

            if (res.ok) {
                const complaints = await res.json();
                console.log("All Complaints:", complaints);
                console.log(JSON.stringify(complaints, null, 2));
                alert(`Found ${complaints.length} total complaints. Check console for details.`);
            } else {
                alert("Error");
            }
        });
    </script>
</body>
</html>
