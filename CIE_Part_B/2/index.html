<!DOCTYPE html>
<html>
<body style="align-items: center; text-align: center">
    
    <h2>Student Fee Management System</h2>

    <h3>Add Student</h3>
    <form id="studentForm">
        <input type="text" id="studentName" placeholder="Student Name" required><br><br>
        <input type="text" id="usn" placeholder="USN" required><br><br>
        <input type="number" id="semester" placeholder="Semester" required><br><br>
        <input type="number" id="examFee" placeholder="Exam Fee" required><br><br>
        <button type="submit">Submit</button>
    </form>

    <br>

    <button id="show-students">Show All Students</button>
    <button id="delete-unpaid">Delete Unpaid Students</button>

    <script>
        // ADD STUDENT
        document.getElementById("studentForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const data = {
                studentName: document.getElementById("studentName").value,
                usn: document.getElementById("usn").value,
                semester: parseInt(document.getElementById("semester").value),
                examFee: parseFloat(document.getElementById("examFee").value)
            };

            const res = await fetch("/students", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                alert("Student saved!");
                document.getElementById("studentForm").reset();
            } else {
                alert("Error!");
            }
        });

        // SHOW ALL STUDENTS
        document.getElementById("show-students").addEventListener("click", async (e) => {
            e.preventDefault();

            const res = await fetch("/students", {
                method: "GET",
            });

            if (res.ok) {
                const students = await res.json();
                console.log("Students:", students);
                console.log(JSON.stringify(students, null, 2));
                alert(`Found ${students.length} students. Check console for details.`);
            } else {
                alert("Error");
            }
        });

        // DELETE UNPAID STUDENTS
        document.getElementById("delete-unpaid").addEventListener("click", async (e) => {
            e.preventDefault();

            if (!confirm("Are you sure you want to delete all students with unpaid fees?")) {
                return;
            }

            const res = await fetch("/students/unpaid", {
                method: "DELETE",
            });

            if (res.ok) {
                const result = await res.json();
                alert(`Deleted ${result.deletedCount} students with unpaid fees!`);
            } else {
                alert("ERROR!");
            }
        });
    </script>
</body>
</html>
