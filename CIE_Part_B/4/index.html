<!DOCTYPE html>
<html>
<body style="align-items: center; text-align: center">
    
    <h2>Hospital Management System</h2>

    <h3>Add Hospital</h3>
    <form id="hospitalForm">
        <input type="text" id="hospitalId" placeholder="Hospital ID" required><br><br>
        <input type="text" id="name" placeholder="Hospital Name" required><br><br>
        <input type="text" id="location" placeholder="Location" required><br><br>
        <input type="number" id="totalBeds" placeholder="Total Beds" required><br><br>
        <input type="number" id="occupiedBeds" placeholder="Occupied Beds" required><br><br>
        <button type="submit">Submit</button>
    </form>

    <br>

    <h3>Admit Patient</h3>
    <form id="admitForm">
        <input type="text" id="admitHospitalId" placeholder="Hospital ID" required><br><br>
        <button type="submit">Admit Patient</button>
    </form>

    <br>

    <button id="show-low-beds">Show Hospitals with Low Beds (&lt;10)</button>
    <button id="show-all">Show All Hospitals</button>

    <script>
        // ADD HOSPITAL
        document.getElementById("hospitalForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const data = {
                hospitalId: document.getElementById("hospitalId").value,
                name: document.getElementById("name").value,
                location: document.getElementById("location").value,
                totalBeds: parseInt(document.getElementById("totalBeds").value),
                occupiedBeds: parseInt(document.getElementById("occupiedBeds").value)
            };

            const res = await fetch("/hospitals", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                alert("Hospital saved!");
                document.getElementById("hospitalForm").reset();
            } else {
                alert("Error!");
            }
        });

        // ADMIT PATIENT
        document.getElementById("admitForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const data = {
                hospitalId: document.getElementById("admitHospitalId").value
            };

            const res = await fetch("/hospitals/admit", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                const result = await res.json();
                alert(`Patient admitted! Occupied beds: ${result.occupiedBeds}`);
                document.getElementById("admitForm").reset();
            } else {
                const error = await res.json();
                alert(`ERROR: ${error.error}`);
            }
        });

        // SHOW HOSPITALS WITH LOW BEDS
        document.getElementById("show-low-beds").addEventListener("click", async (e) => {
            e.preventDefault();

            const res = await fetch("/hospitals/low-beds", {
                method: "GET",
            });

            if (res.ok) {
                const hospitals = await res.json();
                console.log("Hospitals with Low Beds:", hospitals);
                console.log(JSON.stringify(hospitals, null, 2));
                alert(`Found ${hospitals.length} hospitals with less than 10 available beds. Check console for details.`);
            } else {
                alert("Error");
            }
        });

        // SHOW ALL HOSPITALS
        document.getElementById("show-all").addEventListener("click", async (e) => {
            e.preventDefault();

            const res = await fetch("/hospitals", {
                method: "GET",
            });

            if (res.ok) {
                const hospitals = await res.json();
                console.log("All Hospitals:", hospitals);
                console.log(JSON.stringify(hospitals, null, 2));
                alert(`Found ${hospitals.length} total hospitals. Check console for details.`);
            } else {
                alert("Error");
            }
        });
    </script>
</body>
</html>
